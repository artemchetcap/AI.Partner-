# üèóÔ∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

> **–í–µ—Ä—Å–∏—è:** 2.0  
> **–î–∞—Ç–∞:** –¥–µ–∫–∞–±—Ä—å 2024

---

## –û–±–∑–æ—Ä —Å–∏—Å—Ç–µ–º—ã

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ                     TELEGRAM BOT                         ‚îÇ
‚îÇ                   (aiogram 3.x / Python 3.11+)          ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  Handlers    ‚îÇ  FSM States  ‚îÇ  Middlewares  ‚îÇ  Keyboards ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
               ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¥‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚ñº                     ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Services ‚îÇ         ‚îÇ  Models  ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§         ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ AI      ‚îÇ         ‚îÇ User     ‚îÇ
‚îÇ Prompts ‚îÇ         ‚îÇ Generation‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
     ‚îÇ                   ‚îÇ
     ‚ñº                   ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ OpenAI  ‚îÇ         ‚îÇ PostgreSQL‚îÇ
‚îÇ API     ‚îÇ         ‚îÇ (Tortoise)‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –î–ª—è MVP –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º Redis –∏ FastAPI ‚Äî aiogram –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ. –î–æ–±–∞–≤–∏–º –ø–æ –º–µ—Ä–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

---

## –°—Ç–µ–∫ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–π

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|-----------|------------|--------|-------------|
| –Ø–∑—ã–∫ | Python | 3.11+ | Async, —Ç–∏–ø–∏–∑–∞—Ü–∏—è |
| –ë–æ—Ç | aiogram | 3.4+ | Async, FSM, middleware |
| ORM | Tortoise | 0.20+ | Async, –º–∏–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Aerich |
| –ë–î | PostgreSQL | 15+ | –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å |
| AI | OpenAI API | ‚Äî | GPT-4o-mini |
| –ö–æ–Ω—Ñ–∏–≥ | Pydantic Settings | 2.x | –¢–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ |

### –î–æ–±–∞–≤–∏–º –ø–æ–∑–∂–µ (–Ω–µ MVP):
- Redis ‚Äî –∫—ç—à, rate limits
- YooKassa ‚Äî –ø–ª–∞—Ç–µ–∂–∏
- Sentry ‚Äî –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –æ—à–∏–±–æ–∫

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
dogs/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îî‚îÄ‚îÄ bot/
‚îÇ       ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îú‚îÄ‚îÄ main.py                 # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ       ‚îú‚îÄ‚îÄ config.py               # Pydantic Settings
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ handlers/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ start.py            # /start, –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ (–æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ menu.py             # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ kp_generator.py     # üìù –ö–ü-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ messaging.py        # üí¨ –ü–æ–º–æ—â—å —Å –ø–µ—Ä–µ–ø–∏—Å–∫–æ–π
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ ideas.py            # üí° –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ improve.py          # ‚ú® –£–ª—É—á—à–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ keyboards/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ main_menu.py        # –ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ inline.py           # Inline-–∫–Ω–æ–ø–∫–∏ –¥–ª—è —Ñ–∏—á
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ states/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ onboarding.py       # –°–æ—Å—Ç–æ—è–Ω–∏—è –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–∞ (–æ—Ç–ª–æ–∂–µ–Ω–Ω–æ–≥–æ)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ kp.py               # –°–æ—Å—Ç–æ—è–Ω–∏—è –ö–ü-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ messaging.py        # –°–æ—Å—Ç–æ—è–Ω–∏—è –ø–µ—Ä–µ–ø–∏—Å–∫–∏
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ ideas.py            # –°–æ—Å—Ç–æ—è–Ω–∏—è –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–∞ –∏–¥–µ–π
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ improve.py          # –°–æ—Å—Ç–æ—è–Ω–∏—è —É–ª—É—á—à–µ–Ω–∏—è
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ services/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ ai_service.py       # OpenAI –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ prompts.py          # –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–ø—Ç–æ–≤
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ models/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ user.py             # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ generation.py       # –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π
‚îÇ       ‚îÇ
‚îÇ       ‚îú‚îÄ‚îÄ middlewares/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ user_middleware.py  # –ê–≤—Ç–æ-—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ       ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ utils/
‚îÇ           ‚îú‚îÄ‚îÄ __init__.py
‚îÇ           ‚îî‚îÄ‚îÄ text.py             # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–µ–∫—Å—Ç–∞
‚îÇ
‚îú‚îÄ‚îÄ migrations/                      # Aerich –º–∏–≥—Ä–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ tests/
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ pyproject.toml
‚îî‚îÄ‚îÄ README.md
```

---

## –ú–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö

### User

```python
from enum import Enum
from tortoise import fields, Model

class BusinessType(str, Enum):
    FOUNDER = "founder"        # –°–æ–ª–æ-–ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å
    CONSULTANT = "consultant"  # –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç/—ç–∫—Å–ø–µ—Ä—Ç

class User(Model):
    id = fields.BigIntField(pk=True)  # Telegram user_id
    username = fields.CharField(max_length=255, null=True)
    first_name = fields.CharField(max_length=255)
    
    # –ö–æ–Ω—Ç–µ–∫—Å—Ç –±–∏–∑–Ω–µ—Å–∞ (–∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è –ø—Ä–∏ –æ–Ω–±–æ—Ä–¥–∏–Ω–≥–µ)
    business_type = fields.CharEnumField(BusinessType, null=True)
    business_niche = fields.CharField(max_length=255, null=True)
    
    # –õ–∏–º–∏—Ç—ã
    requests_today = fields.IntField(default=0)
    requests_total = fields.IntField(default=0)
    last_request_date = fields.DateField(null=True)
    
    # –ü–æ–¥–ø–∏—Å–∫–∞ (–¥–ª—è –±—É–¥—É—â–µ–≥–æ)
    subscription_tier = fields.CharField(max_length=20, default="free")
    
    created_at = fields.DatetimeField(auto_now_add=True)
    updated_at = fields.DatetimeField(auto_now=True)

    class Meta:
        table = "users"
```

### Generation (–∏—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π)

```python
class GenerationType(str, Enum):
    KP = "kp"                    # –ö–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ
    MESSAGING = "messaging"      # –ü–æ–º–æ—â—å —Å –ø–µ—Ä–µ–ø–∏—Å–∫–æ–π
    BRAINSTORM = "brainstorm"   # –ë—Ä–µ–π–Ω—à—Ç–æ—Ä–º –∏–¥–µ–π
    IMPROVE = "improve"          # –£–ª—É—á—à–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞

class Generation(Model):
    id = fields.UUIDField(pk=True)
    user = fields.ForeignKeyField("models.User", related_name="generations")
    
    type = fields.CharEnumField(GenerationType)
    input_data = fields.JSONField()      # –í—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–∫–ª–∏–µ–Ω—Ç, —É—Å–ª—É–≥–∞, etc.)
    result = fields.TextField()          # –†–µ–∑—É–ª—å—Ç–∞—Ç –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
    
    tokens_used = fields.IntField(null=True)
    model = fields.CharField(max_length=50, default="gpt-4o-mini")
    
    created_at = fields.DatetimeField(auto_now_add=True)

    class Meta:
        table = "generations"
```

---

## FSM States (—Å–æ—Å—Ç–æ—è–Ω–∏—è –¥–∏–∞–ª–æ–≥–æ–≤)

### –û–Ω–±–æ—Ä–¥–∏–Ω–≥ (–æ—Ç–ª–æ–∂–µ–Ω–Ω—ã–π)

> **–í–∞–∂–Ω–æ:** –û–Ω–±–æ—Ä–¥–∏–Ω–≥ –ù–ï –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–≤–æ–º /start. –¢—Ä–∏–≥–≥–µ—Ä–∏—Ç—Å—è –ø–æ—Å–ª–µ 2-3 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π.

```python
class OnboardingStates(StatesGroup):
    waiting_business_type = State()   # –í—ã–±–æ—Ä: Founder / Consultant
    waiting_business_niche = State()  # –í—ã–±–æ—Ä/–≤–≤–æ–¥ –Ω–∏—à–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
```

**–§–ª–æ—É:**
```
[–ü–æ—Å–ª–µ 2-3 –≥–µ–Ω–µ—Ä–∞—Ü–∏–π] ‚Üí "–†–∞—Å—Å–∫–∞–∂–∏ –æ —Å–µ–±–µ"
    ‚Üí [waiting_business_type] –ö–Ω–æ–ø–∫–∏: [üöÄ –ü—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å] [üíº –ö–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç] [‚è≠ –ü–æ–∑–∂–µ]
    ‚Üí [waiting_business_niche] –ö–Ω–æ–ø–∫–∏: [üíª IT] [üìà –ú–∞—Ä–∫–µ—Ç–∏–Ω–≥] [...] [‚è≠ –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å]
    ‚Üí "–ì–æ—Ç–æ–≤–æ! ‚úì"
```

### –ö–ü-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä (3 —à–∞–≥–∞)

```python
class KPStates(StatesGroup):
    waiting_client = State()    # –®–∞–≥ 1: –î–ª—è –∫–æ–≥–æ –ö–ü?
    waiting_service = State()   # –®–∞–≥ 2: –ö–∞–∫–∞—è —É—Å–ª—É–≥–∞?
    waiting_budget = State()    # –®–∞–≥ 3: –ë—é–¥–∂–µ—Ç? (–º–æ–∂–Ω–æ /skip)
    generating = State()        # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è
```

**–§–ª–æ—É:**
```
[–ú–µ–Ω—é] ‚Üí "üìù –°–æ–∑–¥–∞—Ç—å –ö–ü"
    ‚Üí [waiting_client] "–î–ª—è –∫–æ–≥–æ –ö–ü?"
    ‚Üí [waiting_service] "–ö–∞–∫–∞—è —É—Å–ª—É–≥–∞?"
    ‚Üí [waiting_budget] "–ë—é–¥–∂–µ—Ç? (/skip)"
    ‚Üí [generating] "‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É—é..."
    ‚Üí [–†–µ–∑—É–ª—å—Ç–∞—Ç] + [üîÑ –ü–µ—Ä–µ–¥–µ–ª–∞—Ç—å] [üè† –ú–µ–Ω—é]
```

### –ü–æ–º–æ—â—å —Å –ø–µ—Ä–µ–ø–∏—Å–∫–æ–π (3 —à–∞–≥–∞)

```python
class MessagingStates(StatesGroup):
    waiting_situation = State()  # –®–∞–≥ 1: –û–ø–∏—à–∏—Ç–µ —Å–∏—Ç—É–∞—Ü–∏—é
    waiting_goal = State()       # –®–∞–≥ 2: –ß–µ–≥–æ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∏—Ç—å—Å—è?
    waiting_tone = State()       # –®–∞–≥ 3: –í—ã–±–æ—Ä —Ç–æ–Ω–∞
    generating = State()
```

**–§–ª–æ—É:**
```
[–ú–µ–Ω—é] ‚Üí "üí¨ –ü–æ–º–æ—â—å —Å –ø–µ—Ä–µ–ø–∏—Å–∫–æ–π"
    ‚Üí [waiting_situation] "–ö–æ–º—É –ø–∏—à–µ—Ç–µ –∏ —á—Ç–æ —Å–ª—É—á–∏–ª–æ—Å—å?"
    ‚Üí [waiting_goal] "–ß–µ–≥–æ —Ö–æ—Ç–∏—Ç–µ –¥–æ–±–∏—Ç—å—Å—è?"
    ‚Üí [waiting_tone] –ö–Ω–æ–ø–∫–∏: [–ú—è–≥–∫–æ] [–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ] [–ù–∞—Å—Ç–æ–π—á–∏–≤–æ]
    ‚Üí [generating] "‚è≥ –ì–µ–Ω–µ—Ä–∏—Ä—É—é..."
    ‚Üí [–†–µ–∑—É–ª—å—Ç–∞—Ç] ‚Äî –∫–æ—Ä–æ—Ç–∫–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞
```

### –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π (5 ‚Üí +3)

```python
class IdeasStates(StatesGroup):
    waiting_task = State()       # –í–≤–æ–¥ –∑–∞–¥–∞—á–∏/–ø—Ä–æ–±–ª–µ–º—ã
    generating = State()
    showing_results = State()    # –ü–æ–∫–∞–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ + "–ï—â—ë?"
```

**–§–ª–æ—É:**
```
[–ú–µ–Ω—é] ‚Üí "üí° –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∏–¥–µ–π"
    ‚Üí [waiting_task] "–û–ø–∏—à–∏ –∑–∞–¥–∞—á—É..."
    ‚Üí [generating] "üí° –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–¥–µ–∏..."
    ‚Üí [showing_results] 5 –∏–¥–µ–π + [üìã –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å] [üí° –ï—â—ë 3 –∏–¥–µ–∏] [üè† –ú–µ–Ω—é]
    ‚Üí (–µ—Å–ª–∏ "–ï—â—ë") ‚Üí +3 –∏–¥–µ–∏
```

### –£–ª—É—á—à–µ–Ω–∏–µ —Ç–µ–∫—Å—Ç–∞

```python
class ImproveStates(StatesGroup):
    waiting_text = State()       # –í–≤–æ–¥ —Ç–µ–∫—Å—Ç–∞
    waiting_style = State()      # –í—ã–±–æ—Ä —Å—Ç–∏–ª—è
    generating = State()
```

**–°—Ç–∏–ª–∏ —É–ª—É—á—à–µ–Ω–∏—è:**
- –£–±–µ–¥–∏—Ç–µ–ª—å–Ω–µ–µ
- –ö–æ—Ä–æ—á–µ –∏ —á—ë—Ç—á–µ
- –§–æ—Ä–º–∞–ª—å–Ω–µ–µ
- –î—Ä—É–∂–µ–ª—é–±–Ω–µ–µ

---

## –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–ø—Ç–æ–≤

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (—ç–≤–æ–ª—é—Ü–∏—è)

| –≠—Ç–∞–ø | –ü–æ–¥—Ö–æ–¥ | –ö–æ–≥–¥–∞ |
|------|--------|-------|
| **MVP** | `prompts.py` ‚Äî —Å–ª–æ–≤–∞—Ä—å | –°–µ–π—á–∞—Å |
| **–ü–æ—Å–ª–µ PMF** | YAML-—Ñ–∞–π–ª—ã | –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–æ —Ç—é–Ω–∏—Ç—å –±–µ–∑ –¥–µ–ø–ª–æ—è |
| **–ú–∞—Å—à—Ç–∞–±** | –ë–î + A/B —Ç–µ—Å—Ç—ã | –ö–æ–≥–¥–∞ –Ω—É–∂–Ω–∞ –ø–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è |

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–º–ø—Ç–∞

```python
# services/prompts.py

PROMPTS = {
    "kp": {
        "system": """–¢—ã ‚Äî —ç–∫—Å–ø–µ—Ä—Ç –ø–æ B2B –ø—Ä–æ–¥–∞–∂–∞–º —Å 15-–ª–µ—Ç–Ω–∏–º –æ–ø—ã—Ç–æ–º.
–¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –ø–∏—Å–∞—Ç—å —É–±–µ–¥–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è.

–ü—Ä–∞–≤–∏–ª–∞:
- –°—Ç—Ä—É–∫—Ç—É—Ä–∞: –ø—Ä–æ–±–ª–µ–º–∞ ‚Üí —Ä–µ—à–µ–Ω–∏–µ ‚Üí –≤—ã–≥–æ–¥—ã ‚Üí —Ü–µ–Ω–∞ ‚Üí CTA
- –ò—Å–ø–æ–ª—å–∑—É–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —Ü–∏—Ñ—Ä—ã
- –ò–∑–±–µ–≥–∞–π –≤–æ–¥—ã
- –î–ª–∏–Ω–∞: 300-500 —Å–ª–æ–≤

–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –¢–∏–ø: {business_type}
- –ù–∏—à–∞: {business_niche}""",
        
        "user": """–ù–∞–ø–∏—à–∏ –∫–æ–º–º–µ—Ä—á–µ—Å–∫–æ–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:
- –ö–ª–∏–µ–Ω—Ç: {client}
- –£—Å–ª—É–≥–∞: {service}
- –ë—é–¥–∂–µ—Ç: {budget}"""
    },
    
    "messaging": {
        "system": """–¢—ã ‚Äî –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –¥–µ–ª–æ–≤–æ–π –ø–µ—Ä–µ–ø–∏—Å–∫–µ.
–ü–∏—à–µ—à—å –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è WhatsApp/Telegram.

–ü—Ä–∞–≤–∏–ª–∞:
- –ú–∞–∫—Å–∏–º—É–º 2-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è
- –ë–µ–∑ —Ñ–æ—Ä–º–∞–ª—å–Ω–æ—Å—Ç–µ–π ("–° —É–≤–∞–∂–µ–Ω–∏–µ–º" –Ω–µ –Ω—É–∂–Ω–æ)
- –°—Ä–∞–∑—É –∫ –¥–µ–ª—É
- –¢–æ–Ω: {tone}

–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –¢–∏–ø: {business_type}
- –ù–∏—à–∞: {business_niche}""",
        
        "user": """–ù–∞–ø–∏—à–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ:
- –°–∏—Ç—É–∞—Ü–∏—è: {situation}
- –¶–µ–ª—å: {goal}"""
    },
    
    "brainstorm": {
        "system": """–¢—ã ‚Äî –∫—Ä–µ–∞—Ç–∏–≤–Ω—ã–π –±–∏–∑–Ω–µ—Å-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç.
–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—à—å –ø—Ä–∞–∫—Ç–∏—á–Ω—ã–µ –∏–¥–µ–∏ –¥–ª—è –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª–µ–π.

–ü—Ä–∞–≤–∏–ª–∞:
- –ò–¥–µ–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –∏ –ø—Ä–∏–º–µ–Ω–∏–º—ã–º–∏
- –†–∞–∑–Ω–æ–æ–±—Ä–∞–∑–∏–µ: –æ—Ç –ø—Ä–æ—Å—Ç—ã—Ö –¥–æ —Å–º–µ–ª—ã—Ö
- –ö—Ä–∞—Ç–∫–æ: 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –Ω–∞ –∏–¥–µ—é

–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –¢–∏–ø: {business_type}
- –ù–∏—à–∞: {business_niche}""",
        
        "user": "–î–∞–π {count} –∏–¥–µ–π –¥–ª—è: {task}"
    },
    
    "improve": {
        "system": """–¢—ã ‚Äî —Ä–µ–¥–∞–∫—Ç–æ—Ä —Ç–µ–∫—Å—Ç–æ–≤ –¥–ª—è –±–∏–∑–Ω–µ—Å–∞.
–£–ª—É—á—à–∞–µ—à—å —Ç–µ–∫—Å—Ç—ã –ø–æ –∑–∞–ø—Ä–æ—Å—É.

–°—Ç–∏–ª—å —É–ª—É—á—à–µ–Ω–∏—è: {style}

–ö–æ–Ω—Ç–µ–∫—Å—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
- –¢–∏–ø: {business_type}
- –ù–∏—à–∞: {business_niche}""",
        
        "user": "–£–ª—É—á—à–∏ —ç—Ç–æ—Ç —Ç–µ–∫—Å—Ç:\n\n{text}"
    }
}
```

### AI Service

```python
# services/ai_service.py

class AIService:
    def __init__(self, api_key: str, model: str = "gpt-4o-mini"):
        self.client = AsyncOpenAI(api_key=api_key)
        self.model = model
    
    async def generate(
        self, 
        prompt_key: str, 
        user_context: dict,
        **kwargs
    ) -> str:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–∞ –ø–æ –∫–ª—é—á—É –ø—Ä–æ–º–ø—Ç–∞"""
        prompt = PROMPTS[prompt_key]
        
        system = prompt["system"].format(**user_context, **kwargs)
        user = prompt["user"].format(**kwargs)
        
        response = await self.client.chat.completions.create(
            model=self.model,
            messages=[
                {"role": "system", "content": system},
                {"role": "user", "content": user}
            ],
            temperature=0.7,
            max_tokens=1000
        )
        
        return response.choices[0].message.content
    
    async def generate_kp(self, user: User, client: str, service: str, budget: str) -> str:
        return await self.generate(
            "kp",
            user_context={
                "business_type": user.business_type or "–ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å",
                "business_niche": user.business_niche or "–±–∏–∑–Ω–µ—Å"
            },
            client=client,
            service=service,
            budget=budget or "–Ω–µ —É–∫–∞–∑–∞–Ω"
        )
    
    # –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è –¥—Ä—É–≥–∏—Ö –º–µ—Ç–æ–¥–æ–≤...
```

---

## –õ–∏–º–∏—Ç—ã –ø–æ —Ç–∞—Ä–∏—Ñ–∞–º

| –¢–∞—Ä–∏—Ñ | –ó–∞–ø—Ä–æ—Å–æ–≤/–¥–µ–Ω—å | –¶–µ–Ω–∞ | –î–æ—Å—Ç—É–ø |
|-------|---------------|------|--------|
| Free | 15 | 0 ‚ÇΩ | –í—Å–µ –±–∞–∑–æ–≤—ã–µ —Ñ–∏—á–∏ (–¥–∞—Ç—å —Ä–∞—Å–ø—Ä–æ–±–æ–≤–∞—Ç—å) |
| Pro | 100 | 990 ‚ÇΩ/–º–µ—Å | –í—Å–µ —Ñ–∏—á–∏ |
| Business | ‚àû | 2 490 ‚ÇΩ/–º–µ—Å | –í—Å—ë + –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç |

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è –≤ MVP:** –ü—Ä–æ—Å—Ç–æ–π —Å—á—ë—Ç—á–∏–∫ –≤ –º–æ–¥–µ–ª–∏ User, —Å–±—Ä–æ—Å –≤ –ø–æ–ª–Ω–æ—á—å.

---

## –ë—É–¥—É—â–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ (Roadmap)

### P1: –£–ª—É—á—à–µ–Ω–∏—è –ø–æ—Å–ª–µ PMF

| –§–∏—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| YAML-–ø—Ä–æ–º–ø—Ç—ã | –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ –¥–µ–ø–ª–æ—è |
| –ò—Å—Ç–æ—Ä–∏—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–π | –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—à–ª—ã—Ö —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ |
| –ö–Ω–æ–ø–∫–∞ "–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å" | –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ –±—É—Ñ–µ—Ä |
| Telegram Premium | –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ, –¥–ª–∏–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è |

### P2: –î–∏–∞–ª–æ–≥–æ–≤—ã–π —Ä–µ–∂–∏–º

**–°—Ü–µ–Ω–∞—Ä–∏–π A: AI-—Ä–µ–¥–∞–∫—Ç–æ—Ä (–∏—Ç–µ—Ä–∞—Ç–∏–≤–Ω—ã–π)**
```
User: –ù–∞–ø–∏—à–∏ –ö–ü
Bot: [–≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç]
User: –°–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ
Bot: [—Å–æ–∫—Ä–∞—â–∞–µ—Ç]
User: –î–æ–±–∞–≤—å —Ü–∏—Ñ—Ä—ã
Bot: [–¥–æ–±–∞–≤–ª—è–µ—Ç]
```

**–°—Ü–µ–Ω–∞—Ä–∏–π B: AI-–∫–æ–Ω—Å—É–ª—å—Ç–∞–Ω—Ç (—Å—Ç—Ä–∞—Ç–µ–≥–∏—á–µ—Å–∫–∏–π)**
```
User: –•–æ—á—É —É–≤–µ–ª–∏—á–∏—Ç—å –¥–æ—Ö–æ–¥ —Å 200–∫ –¥–æ 500–∫
Bot: –†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ: —Å–∫–æ–ª—å–∫–æ –∫–ª–∏–µ–Ω—Ç–æ–≤, –∫–∞–∫–æ–π —á–µ–∫?
User: 5 –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ 40–∫
Bot: –í–∏–∂—É 3 –ø—É—Ç–∏: 1) –±–æ–ª—å—à–µ –∫–ª–∏–µ–Ω—Ç–æ–≤ 2) –≤—ã—à–µ —á–µ–∫ 3) –Ω–æ–≤—ã–µ —É—Å–ª—É–≥–∏...
```

**–°—Ü–µ–Ω–∞—Ä–∏–π C: –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫**
```
User: –ö–ª–∏–µ–Ω—Ç –ò–≤–∞–Ω –Ω–µ –æ—Ç–≤–µ—á–∞–µ—Ç
Bot: –≠—Ç–æ —Ç–æ—Ç –ò–≤–∞–Ω –∏–∑ —Ä–µ—Å—Ç–æ—Ä–∞–Ω–∞? ‚Üê –ø–æ–º–Ω–∏—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç
User: –î–∞
Bot: –í–æ—Ç –≤–∞—Ä–∏–∞–Ω—Ç—ã –Ω–∞–ø–æ–º–Ω–∏—Ç—å: [...]
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:**
- –ë–î –¥–ª—è –¥–æ–ª–≥–æ—Å—Ä–æ—á–Ω–æ–π –ø–∞–º—è—Ç–∏
- –ò—Å—Ç–æ—Ä–∏—è –¥–∏–∞–ª–æ–≥–æ–≤ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ OpenAI
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω—ã–µ FSM –∏–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ LangChain

### P3: –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ

| –§–∏—á–∞ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------|----------|
| A/B —Ç–µ—Å—Ç—ã –ø—Ä–æ–º–ø—Ç–æ–≤ | –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –≤—ã–±–æ—Ä –ª—É—á—à–µ–≥–æ |
| –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –Ω–∏—à–∞–º | –†–∞–∑–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –Ω–∏—à |
| –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã | Premium: —Å–≤–æ–π —Å—Ç–∏–ª—å –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ |
| API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π | –î–æ—Å—Ç—É–ø —á–µ—Ä–µ–∑ API –¥–ª—è Business |

---

## –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –í—Å–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ `.env` (–Ω–µ –≤ –∫–æ–¥–µ)
- –í–∞–ª–∏–¥–∞—Ü–∏—è Telegram webhook signature
- Rate limiting –Ω–∞ —É—Ä–æ–≤–Ω–µ middleware
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ PII (–ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö)

---

## –î–µ–ø–ª–æ–π

### Development
```bash
docker-compose up -d
```

### Production (–±—É–¥—É—â–µ–µ)
- VPS: Timeweb / Selectel
- Reverse proxy: Nginx
- SSL: Let's Encrypt
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥: Sentry

---

*–í–µ—Ä—Å–∏—è: 2.0*  
*–û–±–Ω–æ–≤–ª–µ–Ω–æ: –¥–µ–∫–∞–±—Ä—å 2024*  
*–ò–∑–º–µ–Ω–µ–Ω–∏—è: FSM states, —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–º–ø—Ç–æ–≤, —Ñ–∏—á–∏ MVP, roadmap –¥–∏–∞–ª–æ–≥–æ–≤–æ–≥–æ —Ä–µ–∂–∏–º–∞*
